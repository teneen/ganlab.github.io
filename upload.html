<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <script src="https://cdn.jsdelivr.net/npm/jquery@2.2.4/dist/jquery.min.js"></script>
</head>
<body>
    <input type="file" id="file">

    <script type="text/javascript">
		
		var GDup = {
			
			url : 'https://script.google.com/macros/s/AKfycbwL2RCN-bl2bJs5ZGZJxkemUxjDr0jgv0U9BkyyL6b5CeHBsrWr/exec',
			
			mid : function (length){
				var text = '';
				var possible = 'abcdefghijklmnopqrstuvwxyz0123456789';
				for (var i = 0; i < length; i++) text += possible.charAt(Math.floor(Math.random() * possible.length));
				return text;
			},
			
			result : function (e) {
				console.log(e);
			},
			
			upload : function (file) {
				
				// create parameters
				var params = {};
				
				// format
				params.ext = file.name.split('.').pop();
				
				// file
                var fr = new FileReader();
				
                fr.onload = function(e) {
                    
					params.file = e.target.result.replace(/^.*,/, '');
                    
					try {
						// Date
						var d    = new Date();
						var date = d.getFullYear() + '_' + d.getMonth() + '_';
						
						// Create file name
						var name = date + GDup.mid(30);
						
						// Name
						params.name = name;
						
						// Create iframe
						var upIFrame	= document.createElement('iframe');
						upIFrame.style	= "display:none; width:0px";
						upIFrame.src	= "about:blank";
						upIFrame.id		= "upIFrame" + name;
						upIFrame.name	= "upIFrame" + name;
						upIFrame.onload	= function() {
							console.log(this);
						   var ini = $(this)[0];
						   try {
							   ini.contentDocument;
						   } catch(err){
								params.file = 'no';
								var request = jQuery.ajax({
								  crossDomain	: true,
								  url			: GDup.url + '?' + jQuery.param(params),
								  method		: "GET",
								  dataType		: "jsonp"
								});
						   }
						}
						document.body.appendChild(upIFrame);
						
						// Create form
						var idocument = upIFrame.contentWindow.document;
						loginForm = idocument.createElement("form");
						loginForm.setAttribute("target", "upIFrame" + name);
						loginForm.setAttribute("method", "POST");
						loginForm.setAttribute("action", GDup.url);
						for(var key in params)
						{
							var hiddenField = idocument.createElement("input");
							hiddenField.setAttribute('type', "hidden");
							hiddenField.setAttribute('name', key);
							hiddenField.setAttribute('value', params[key]);
							loginForm.appendChild(hiddenField);
						}
						upIFrame.appendChild(loginForm);
						
						// submit form
						loginForm.submit();
					
					} catch(err){
						console.log(err);
					}
					
                }
                fr.readAsDataURL(file);
			}
		
		}
		
        $(function(){
            $('#file').on("change", function() {
				var file = this.files[0];
				GDup.upload(file);
            });
        });
    </script>
</body>
</html>
